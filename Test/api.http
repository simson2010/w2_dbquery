### REST Client API Tests for w2_dbquery Backend
### Base URL: http://localhost:8000

@baseUrl = http://localhost:8000

### PostgreSQL Connection Variables
@pgHost = 192.168.3.136
@pgPort = 5432
@pgUser = demo_user
@pgPassword = 123456
@pgDatabase = postgres
@connectionString = postgresql://{{pgUser}}:{{pgPassword}}@{{pgHost}}:{{pgPort}}/{{pgDatabase}}

### ============================================
### 1. Health Check
### ============================================

### 1.1 健康检查
GET {{baseUrl}}/health

### ============================================
### 2. Connections API
### ============================================

### 2.1 添加新连接
POST {{baseUrl}}/api/connections
Content-Type: application/json

{
    "name": "test-db",
    "connection_string": "{{connectionString}}"
}

### 2.2 获取所有连接
GET {{baseUrl}}/api/connections

### 2.3 测试连接 (替换 {id} 为实际连接 ID)
POST {{baseUrl}}/api/connections/2/test

### 2.4 获取数据库 Schema (替换 {id} 为实际连接 ID)
GET {{baseUrl}}/api/connections/3/schema

### 2.5 删除连接 (替换 {id} 为实际连接 ID)
DELETE {{baseUrl}}/api/connections/2

### ============================================
### 3. Query API
### ============================================

### 3.1 生成 SQL (自然语言转 SQL)
POST {{baseUrl}}/api/generate-sql
Content-Type: application/json

{
    "connection_id": 3,
    "natural_language_query": "查询所有用户显示前10条，和显示用户名称"
}

### 3.2 执行 SQL 查询
POST {{baseUrl}}/api/execute-sql
Content-Type: application/json

{
    "connection_id": 3,
    "sql": "SELECT id, username, full_name, email FROM users LIMIT 10;"
}

### ============================================
### 4. SQL Validation Tests (应被拒绝)
### ============================================

### 4.1 DELETE 语句 - 应返回 400 错误
POST {{baseUrl}}/api/execute-sql
Content-Type: application/json

{
    "connection_id": 3,
    "sql": "DELETE FROM users WHERE id = 3"
}

### 4.2 DROP 语句 - 应返回 400 错误
POST {{baseUrl}}/api/execute-sql
Content-Type: application/json

{
    "connection_id": 3,
    "sql": "DROP TABLE users"
}

### 4.3 UPDATE 语句 - 应返回 400 错误
POST {{baseUrl}}/api/execute-sql
Content-Type: application/json

{
    "connection_id": 3,
    "sql": "UPDATE users SET name = 'test' WHERE id = 1"
}

### 4.4 INSERT 语句 - 应返回 400 错误
POST {{baseUrl}}/api/execute-sql
Content-Type: application/json

{
    "connection_id": 3,
    "sql": "INSERT INTO users (name) VALUES ('test')"
}

### 4.5 多语句执行 - 应返回 400 错误
POST {{baseUrl}}/api/execute-sql
Content-Type: application/json

{
    "connection_id": 3,
    "sql": "SELECT * FROM users; DROP TABLE users;"
}
